<div class="chatbot-container">
  <button class="chatbot-btn" (click)="toggleChatbot()">💬</button>

  <div class="chatbot-window" *ngIf="chatbotOpen">
    <div class="chatbot-header">
      <span>AI Chatbot</span>
      <button class="close-btn" (click)="toggleChatbot()">×</button>
    </div>

    <div class="chatbot-body" #chatBody>
  <div *ngFor="let msg of messages" [ngClass]="msg.sender" class="chat-message">
    <!-- پیام متنی -->
    <div *ngIf="msg.text">
      <span>{{ msg.text }}</span>
      <div class="timestamp">
        {{ msg.timestamp | date:'MMM d, y, HH:mm' }}
      </div>
    </div>

    <!-- پیام فایل: separate branches for pdf and image -->
    <ng-container *ngIf="msg.fileType">
      <div *ngIf="msg.fileType === 'pdf'" class="file-message">
        <span [innerHTML]="pdfIconSafe"></span>
        <span class="file-name">{{ msg.fileName }}</span>
        <div class="timestamp">
          {{ msg.timestamp | date:'MMM d, y, HH:mm' }}
        </div>
      </div>

      <div *ngIf="msg.fileType === 'image'" class="file-message">
        <img [src]="msg.fileUrl || '/assets/image-icon.png'" alt="image file" width="40" height="40"
             style="border-radius: 6px; margin-right: 8px;" />
        <span class="file-name">{{ msg.fileName }}</span>
        <div class="timestamp">
          {{ msg.timestamp | date:'MMM d, y, HH:mm' }}
        </div>
      </div>
    </ng-container>
  </div>
</div>

    <div class="chatbot-footer">
      <input
        type="text"
        [(ngModel)]="userInput"
        (keydown.enter)="sendMessage()"
        placeholder="Type a message..."
      />

      <!-- دکمه میکروفون -->
      <button class="icon-btn" (click)="startDictation()">
        🎤
      </button>

      <!-- دکمه آپلود -->
      <button class="icon-btn" (click)="triggerFileUpload()">
        📎
      </button>
      <input
        type="file"
        #fileInput
        style="display: none"
        accept="application/pdf, image/*"
        (change)="onFileSelected($event)"
      />

      <!-- دکمه ارسال -->
      <button class="icon-btn" (click)="sendMessage()">
        ➤
      </button>
    </div>

    <!-- نمایش نام فایل انتخاب‌شده -->
    <div *ngIf="selectedFileName" class="file-info">
      Selected: {{ selectedFileName }}
    </div>
  </div>
</div>
